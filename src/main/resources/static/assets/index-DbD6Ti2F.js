import{P as Z,F as j,a as J,b as M,c as Q,D as X}from"./PageContainer-BNl7fdCx.js";import{i as z,a as K,_ as R,b as U}from"./request-gITGYgwF.js";import{_ as G,B as h}from"./_plugin-vue_export-helper-Di4M-4iM.js";import{r as i,o as N,c as H,w as t,a as e,b as y,f as W,X as Y,J as ee,_ as g,h as f}from"./index-DwARuaTP.js";import{o as P,N as C,E as te}from"./EditNoteOutlined-DEdCU_tm.js";import{P as ae}from"./PlusOutlined-Cn6C1N3q.js";import"./Card-CAlJ-zJ5.js";import"./Tooltip-TLTbEFla.js";import"./Ellipsis-Ks8fyx6B.js";const ne=u=>z.post("/item/list",u),le=u=>z.post("/item",u),oe=u=>z.delete(`/item/${u}`),ie={style:{display:"flex","justify-content":"flex-end"}},se={__name:"ItemEdit",emits:["submit"],setup(u,{expose:b,emit:k}){const r=i(!1),m=i(""),a=i({id:0,name:"",code:"",apiId:"",apiKey:""}),S={name:[{required:!0,message:"请输入项目名",trigger:"blur"},{pattern:/^\S{1,10}$/,message:"项目名应为长度为 1-10 的非空字符",trigger:"blur"}],code:[{required:!0,message:"请输入项目代码",trigger:"blur"},{pattern:/^[a-zA-Z0-9]{6}$/,message:"项目代码应为长度为 6 的字母和数字",trigger:"blur"}],apiId:[{required:!0,message:"请输入Api Id",trigger:"blur"},{pattern:/^[0-9]{6}$/,message:"Api Id 应为长度为 6 的字母和数字",trigger:"blur"}],apiKey:[{required:!0,message:"请输入Api Key",trigger:"blur"},{pattern:/^[a-zA-Z0-9]{25}$/,message:"Api Key 应为 长度为 25 的字母和数字",trigger:"blur"}]};b({open:d=>{r.value=!0,a.value={...d},a.value.apiId=a.value.apiId.toString()}});const s=k,w=async()=>{await m.value.validate(),await le(a.value).then(()=>{const d=a.value.id?"编辑":"新增";window.$message.success(`成功${d}项目 ${a.value.name}！`),s("submit")}),r.value=!1};return(d,o)=>{const p=h,c=K,_=R,$=U,x=P;return N(),H(x,{show:r.value,"onUpdate:show":o[5]||(o[5]=l=>r.value=l),preset:"card",title:a.value.id?"编辑项目":"新增项目",style:{width:"450px"},segmented:{content:"soft"}},{"header-extra":t(()=>[e(p,{secondary:"",type:"primary",tag:"a",href:"https://en.neverlose.cc/market/api",target:"_blank"},{default:t(()=>[y("查询 API")]),_:1})]),default:t(()=>[e($,{size:"large",ref_key:"formRef",ref:m,model:a.value,rules:S},{default:t(()=>[e(_,{label:"项目名",path:"name"},{default:t(()=>[e(c,{value:a.value.name,"onUpdate:value":o[0]||(o[0]=l=>a.value.name=l),clearable:""},null,8,["value"])]),_:1}),e(_,{label:"项目代码",path:"code"},{default:t(()=>[e(c,{value:a.value.code,"onUpdate:value":o[1]||(o[1]=l=>a.value.code=l),clearable:""},null,8,["value"])]),_:1}),e(_,{label:"Api Id",path:"apiId"},{default:t(()=>[e(c,{value:a.value.apiId,"onUpdate:value":o[2]||(o[2]=l=>a.value.apiId=l),clearable:""},null,8,["value"])]),_:1}),e(_,{label:"Api Key",path:"apiKey"},{default:t(()=>[e(c,{value:a.value.apiKey,"onUpdate:value":o[3]||(o[3]=l=>a.value.apiKey=l),clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),footer:t(()=>[W("div",ie,[e(p,{ghost:"",onClick:o[4]||(o[4]=l=>r.value=!1),size:"medium"},{default:t(()=>[y("取消")]),_:1}),e(p,{type:"primary",size:"medium",style:{"margin-left":"10px"},onClick:w},{default:t(()=>[y("确定")]),_:1})])]),_:1},8,["show","title"])}}},ue=G(se,[["__scopeId","data-v-217b6414"]]),ye={__name:"index",setup(u){const b=i(!1),k=i(),r=()=>{var n;(n=k.value)==null||n.downloadCsv({fileName:"Items"})},m=i(),a=i({}),S=[{title:"项目名",key:"name"},{title:"项目代码",key:"code"},{title:"Api ID",key:"apiId"},{title:"Api Key",key:"apiKey"},{title:"操作",key:"actions",fixed:"right",align:"right",width:320,render(n){return[f(h,{size:"medium",style:{marginRight:"10px"},type:"primary",onClick:()=>_(n)},{default:()=>"编辑",icon:()=>f(C,null,{default:()=>f(te)})}),f(h,{size:"medium",type:"error",onClick:()=>E(n)},{default:()=>"删除",icon:()=>f(C,null,{default:()=>f(X)})})]}}],A=i([]),s=i({page:1,pageSize:10,name:""}),w=async()=>{b.value=!0,await ne(s.value).then(({data:n})=>{A.value=n.records,a.value.page=n.page,a.value.pageSize=n.pageSize,a.value.itemCount=n.itemCount,a.value.pageCount=n.pageCount}).finally(()=>{b.value=!1})};w();const d=async n=>{s.value.page=n,await w()},o=async()=>{s.value.page=1,await w()},p=()=>{s.value.page=1,s.value.name="",o()},c=()=>{m.value.open()},_=n=>{m.value.open(n)},$=async()=>{await p()},x=i(0),l=i(!1),E=n=>{l.value=!0,x.value=n.id},B=async()=>{l.value=!1,await oe(x.value).then(async()=>{window.$message.success("成功删除项目！"),await p()})};return(n,v)=>{const D=J,q=K,F=M,O=R,T=U,V=Q,L=P;return N(),Y(ee,null,[e(Z,{titleText:"项目管理","onReset:btnClick":p,"onSearch:btnClick":o},{extra:t(()=>[e(g(h),{ghost:"",onClick:r},{icon:t(()=>[e(g(C),null,{default:t(()=>[e(g(j))]),_:1})]),default:t(()=>[y(" 导出 ")]),_:1}),e(g(h),{type:"primary",onClick:c,style:{"margin-left":"10px"}},{icon:t(()=>[e(g(C),null,{default:t(()=>[e(g(ae))]),_:1})]),default:t(()=>[y(" 新增 ")]),_:1})]),"search-form":t(()=>[e(T,{inline:"",model:s.value},{default:t(()=>[e(O,null,{default:t(()=>[e(F,null,{default:t(()=>[e(D,null,{default:t(()=>[y("项目名")]),_:1}),e(q,{value:s.value.name,"onUpdate:value":v[0]||(v[0]=I=>s.value.name=I)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),"data-show":t(()=>[e(V,{ref_key:"tableRef",ref:k,striped:"",remote:"",loading:b.value,style:{"margin-top":"20px"},columns:S,data:A.value,pagination:a.value,"onUpdate:page":d},null,8,["loading","data","pagination"])]),_:1}),e(ue,{ref_key:"modalRef",ref:m,onSubmit:$},null,512),e(L,{show:l.value,"onUpdate:show":v[1]||(v[1]=I=>l.value=I),preset:"dialog",title:"确认",content:"你确认要删除该项目吗?","positive-text":"确认","negative-text":"取消",onNegativeClick:v[2]||(v[2]=I=>l.value=!1),onPositiveClick:B},null,8,["show"])],64)}}};export{ye as default};
