import{P as F,a as L,b as Z,c as j,D as J}from"./PageContainer-DueDO1Bx.js";import{i as z,a as K,_ as U,b as P}from"./request-B4iOZCux.js";import{_ as M,B as I}from"./_plugin-vue_export-helper-BPb2jorM.js";import{r as u,o as R,c as Q,w as t,a as e,b,f as X,X as G,J as H,_ as A,h as v}from"./index-D_FV4neq.js";import{o as N,N as $,E as W}from"./EditNoteOutlined-PSN8tMNE.js";import{P as Y}from"./PlusOutlined-B39C1Jue.js";import"./Card-Ba_cy-W3.js";import"./Tooltip-DLKm6Ems.js";import"./Ellipsis-UNTCCfHi.js";const ee=p=>z.post("/item/list",p),te=p=>z.post("/item",p),ae=p=>z.delete(`/item/${p}`),ne={style:{display:"flex","justify-content":"flex-end"}},le={__name:"ItemEdit",emits:["submit"],setup(p,{expose:g,emit:f}){const i=u(!1),w=u(""),a=u({id:0,name:"",code:"",apiId:"",apiKey:""}),s={name:[{required:!0,message:"请输入项目名",trigger:"blur"},{pattern:/^\S{1,10}$/,message:"项目名应为长度为 1-10 的非空字符",trigger:"blur"}],code:[{required:!0,message:"请输入项目代码",trigger:"blur"},{pattern:/^[a-zA-Z0-9]{6}$/,message:"项目代码应为长度为 6 的字母和数字",trigger:"blur"}],apiId:[{required:!0,message:"请输入Api Id",trigger:"blur"},{pattern:/^[0-9]{6}$/,message:"Api Id 应为长度为 6 的字母和数字",trigger:"blur"}],apiKey:[{required:!0,message:"请输入Api Key",trigger:"blur"},{pattern:/^[a-zA-Z0-9]{25}$/,message:"Api Key 应为 长度为 25 的字母和数字",trigger:"blur"}]};g({open:r=>{i.value=!0,a.value={...r},a.value.apiId=a.value.apiId.toString()}});const C=f,k=async()=>{await w.value.validate(),await te(a.value).then(()=>{const r=a.value.id?"编辑":"新增";window.$message.success(`成功${r}项目 ${a.value.name}！`),C("submit")}),i.value=!1};return(r,l)=>{const y=I,c=K,m=U,d=P,S=N;return R(),Q(S,{show:i.value,"onUpdate:show":l[5]||(l[5]=o=>i.value=o),preset:"card",title:a.value.id?"编辑项目":"新增项目",style:{width:"450px"},segmented:{content:"soft"}},{"header-extra":t(()=>[e(y,{secondary:"",type:"primary",tag:"a",href:"https://en.neverlose.cc/market/api",target:"_blank"},{default:t(()=>[b("查询 API")]),_:1})]),default:t(()=>[e(d,{size:"large",ref_key:"formRef",ref:w,model:a.value,rules:s},{default:t(()=>[e(m,{label:"项目名",path:"name"},{default:t(()=>[e(c,{value:a.value.name,"onUpdate:value":l[0]||(l[0]=o=>a.value.name=o),clearable:""},null,8,["value"])]),_:1}),e(m,{label:"项目代码",path:"code"},{default:t(()=>[e(c,{value:a.value.code,"onUpdate:value":l[1]||(l[1]=o=>a.value.code=o),clearable:""},null,8,["value"])]),_:1}),e(m,{label:"Api Id",path:"apiId"},{default:t(()=>[e(c,{value:a.value.apiId,"onUpdate:value":l[2]||(l[2]=o=>a.value.apiId=o),clearable:""},null,8,["value"])]),_:1}),e(m,{label:"Api Key",path:"apiKey"},{default:t(()=>[e(c,{value:a.value.apiKey,"onUpdate:value":l[3]||(l[3]=o=>a.value.apiKey=o),clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),footer:t(()=>[X("div",ne,[e(y,{ghost:"",onClick:l[4]||(l[4]=o=>i.value=!1),size:"medium"},{default:t(()=>[b("取消")]),_:1}),e(y,{type:"primary",size:"medium",style:{"margin-left":"10px"},onClick:k},{default:t(()=>[b("确定")]),_:1})])]),_:1},8,["show","title"])}}},oe=M(le,[["__scopeId","data-v-217b6414"]]),ve={__name:"index",setup(p){const g=u(!1),f=u(),i=u({}),w=[{title:"项目名",key:"name"},{title:"项目代码",key:"code"},{title:"Api ID",key:"apiId"},{title:"Api Key",key:"apiKey"},{title:"操作",key:"actions",fixed:"right",align:"right",width:320,render(n){return[v(I,{size:"medium",style:{marginRight:"10px"},type:"primary",onClick:()=>y(n)},{default:()=>"编辑",icon:()=>v($,null,{default:()=>v(W)})}),v(I,{size:"medium",type:"error",onClick:()=>S(n)},{default:()=>"删除",icon:()=>v($,null,{default:()=>v(J)})})]}}],a=u([]),s=u({page:1,pageSize:10,name:""}),h=async()=>{g.value=!0,await ee(s.value).then(({data:n})=>{a.value=n.records,i.value.page=n.page,i.value.pageSize=n.pageSize,i.value.itemCount=n.itemCount,i.value.pageCount=n.pageCount}).finally(()=>{g.value=!1})};h();const C=async n=>{s.value.page=n,await h()},k=async()=>{s.value.page=1,await h()},r=()=>{s.value.page=1,s.value.name="",k()},l=()=>{f.value.open()},y=n=>{f.value.open(n)},c=async()=>{await r()},m=u(0),d=u(!1),S=n=>{d.value=!0,m.value=n.id},o=async()=>{d.value=!1,await ae(m.value).then(async()=>{window.$message.success("成功删除项目！"),await r()})};return(n,_)=>{const B=L,E=K,q=Z,D=U,O=P,T=j,V=N;return R(),G(H,null,[e(F,{titleText:"项目管理","onReset:btnClick":r,"onSearch:btnClick":k},{extra:t(()=>[e(A(I),{type:"primary",onClick:l},{icon:t(()=>[e(A($),null,{default:t(()=>[e(A(Y))]),_:1})]),default:t(()=>[b(" 新增 ")]),_:1})]),"search-form":t(()=>[e(O,{inline:"",model:s.value},{default:t(()=>[e(D,null,{default:t(()=>[e(q,null,{default:t(()=>[e(B,null,{default:t(()=>[b("项目名")]),_:1}),e(E,{value:s.value.name,"onUpdate:value":_[0]||(_[0]=x=>s.value.name=x)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),"data-show":t(()=>[e(T,{striped:"",remote:"",loading:g.value,style:{"margin-top":"20px"},columns:w,data:a.value,pagination:i.value,"onUpdate:page":C},null,8,["loading","data","pagination"])]),_:1}),e(oe,{ref_key:"modalRef",ref:f,onSubmit:c},null,512),e(V,{show:d.value,"onUpdate:show":_[1]||(_[1]=x=>d.value=x),preset:"dialog",title:"确认",content:"你确认要删除该项目吗?","positive-text":"确认","negative-text":"取消",onNegativeClick:_[2]||(_[2]=x=>d.value=!1),onPositiveClick:o},null,8,["show"])],64)}}};export{ve as default};
